ПОДСИСТЕМА ГЕОДАННЫХ
====================

Введение
--------------------

Подсистема геоданных представляет собой комплекс платформенных функций,
доступных в составе Платформы автоматизации «CITORUS» при условии
наличия серверного дополнения Веб-ГИС платформы «ЦИТОРУС.ГИС».

Данные функции позволяют решать различные задачи в конфигурациях,
создаваемых на базе Платформы автоматизации CITORUS, с преобладающей
картографической компонентой.

В частности:

-  Управление массивами геокодированных данных в объектном представлении
   в составе базы данных.
-  Управление геокодированными данными посредством встроенного в
   пользовательский интерфейс ГИС-инструментария.
-  Управление геоинформационными слоями в различных векторных и
   растровых форматах, настройка параметров хранения, обработки,
   визуализации, кэширования таких слоев.
-  Импорт/экспорт массивов геокодированных данных в различных форматах,
   поддержка синхронизации с внешними системами.
-  Визуализация геоинформационных слоев, размещенных на удаленных
   ресурсах.

Управление геокодированными объектами. Универсальная геокатегория
-----------------------------------------------------------------

Информационные объекты системы создаются на основе типов объектов. Типы
объектов собираются из категорий. Каждая категория представляет собой
определенный набор свойств объекта. Как правило, типы собираются из
категорий, которые содержат атрибутивную информацию об объекте:
название, описание и т.д. Такие категории создаются пользователями
вручную исходя из свойств объектов, которыми оперирует система.

Кроме того, в тип может быть добавлена категория, которая содержит
геоданные объекта. Эта категория представлена в системе по умолчанию и
называется *универсальной геокатегорией*. Универсальная геокатегория
(также – *геокатегория*) может быть включена в состав любого типа
объектов при создании нового типа или редактировании существующего.

Если в тип объектов добавлена геокатегория, то каждый объект, который
создан на основе данного типа, имеет геокатегорию (рис. 103).
Геокатегория объекта содержит географические координаты данного объекта,
визуально представляет его на карте и обеспечивает возможность его
редактирования.

На рисунке 1 представлены инструменты геокатегории объекта:

1. Карта.
2. Визуальный редактор.
3. Область географических координат объекта.
4. Инструменты экспорта/импорта геоданных объекта.

.. raw:: html

|image0|

.. raw:: html

Рисунок 103 – Универсальная геокатегория

.. raw:: html

Работа с картой в универсальной геокатегории
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Изменение масштаба карты в универсальной геокатегории выполняется
стандартными способами, которые используются при работе с
географическими информационными системами. Например:

1. Прокруткой колесика мыши: прокручивание от себя увеличивает масштаб,
   на себя – уменьшает.
2. С помощью масштабной линейки, которая расположена в левой части
   карты: нажатие на кнопку |image1| или перемещение бегунка вверх
   увеличивает масштаб, нажатие кнопки |image2| и перемещение бегунка
   вниз уменьшает масштаб.

Для перемещения по карте можно использовать клавиши клавиатуры, на
которых изображены стрелки, указывающие вверх, вниз, влево и вправо.
Кроме того, перемещаться по карте можно, удерживая левую клавишу мыши.

Для быстрого возврата к маркеру объекта предназначена кнопка
**Цель** |image3|, которая расположена в левой части карты.

При необходимости на карте можно отобразить координатную сетку. Для
этого следует нажать на кнопку **Свернуть/Развернуть** |image4|, а затем
– на кнопку **Координатная сетка** |image5|.

Добавление геоданных объекта
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Если карточка объекта была создана пустой, и геокатегория не содержит
геоданных, в области координат объекта (рис. 104) укажите:

-  Географические координаты объекта, если объект следует представить на
   карте в виде маркера.
-  Географические координаты первой точки объекта, если объект следует
   представить на карте в виде линии или полигона.

Географические координаты можно указать в следующих форматах:

-  в градусах в виде десятичной дроби (разделитель – запятая) – данный
   формат выбран по умолчанию;
-  в градусах, минутах и секундах.

Переключение между форматами осуществляется с помощью кнопок
**ГГ.ГГГГГГ** и **ГГºММ'СС.с**.

.. raw:: html

   <center> 

|image6|

.. raw:: html

   </center>

   <center>

Рисунок 104 – Область координат объекта

.. raw:: html

   </center>

Указанная географическая координата отобразится на карте в виде маркера.
При необходимости выполните дальнейшее редактирование фигуры объекта
так, как это описано ниже.

Редактирование геоданных объекта
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Редактирование фигуры объекта можно выполнять:

-  На карте, с помощью инструментов визуального редактора. При этом в
   области координат будут соответствующим образом меняться координаты
   точек фигуры.
-  В области координат, вручную добавляя и редактируя координаты точек.
   При этом на карте в реальном режиме времени фигура будет перемещаться
   и видоизменяться в соответствии с указанными координатами.

Чтобы редактировать фигуру с помощью карты, в левой части карты нажмите
на кнопку **Свернуть/Развернуть** |image7|. Поверх карты отобразятся
инструменты визуального редактора (рис. 105).

Если объект представлен на карте в виде маркера, и этот маркер требуется
переместить, нажмите на кнопку **Редактировать слой** |image8|. Затем
переместите маркер с помощью мыши в требуемое место и нажмите на кнопку
**Сохранить**, которая отображается под кнопкой |image9|.

.. raw:: html

   <center> 

|image10|

.. raw:: html

   </center>

   <center>

Рисунок 105 – Перемещение маркера

.. raw:: html

   </center>

Если из точки следует сделать линию, добавьте на карту новую точку. Для
этого нажмите на кнопку |image11|. Указатель мыши преобразится в маркер
(рис. 106). Установите данный маркер щелчком мыши на требуемом месте
карты. От первого маркера до второго будет прорисована линия.

.. raw:: html

   <center>

|image12|

.. raw:: html

   </center>

   <center>

Рисунок 106 – Установка маркера

.. raw:: html

   </center>

Если из линии требуется сделать полигон, воспользуйтесь одним из
следующих способов:

1. Добавьте новые точки тем же способом. Для выхода из режима установки
   маркеров нажмите на кнопку **Отмена**, которая отображается под
   кнопкой |image13|.
2. Выйдите из режима установки маркеров и перейдите в режим
   редактирования слоя. Для этого нажмите на кнопку **Редактировать
   слой** |image14|. Для прорисовки полигона последовательно перемещайте
   мышью промежуточные точки, которые отображаются на линии (рис. 107).
   Чтобы выйти из режима редактирования слоя, нажмите на кнопку
   **Сохранить**, которая расположена под кнопкой **Редактировать слой**
   |image15|.

Если требуется удалить какую-либо из точек фигуры, используйте
соответствующую команду контекстного меню области координат (см. ниже).

.. raw:: html

   <center>

|image16|

.. raw:: html

   </center>

   <center>

Рисунок 107 – Прорисовка полигона

.. raw:: html

   </center>

Чтобы добавить для фигуры новые точки в области координат,
воспользуйтесь одним из следующих способов:

1. Нажмите правой клавишей мыши на кнопку |image17|, которая расположена
   слева от требуемой координаты. Например, если новую точку следует
   добавить между первой и второй координатой, нажмите на кнопку
   |image18|, расположенную слева от первой координаты (рис. 108). Затем
   выполните одну из следующих команд контекстного меню:
    * **Создать новый** – чтобы создать координату, в полях **Широта** и **Долгота** которой будут указаны градусы (целые числа до запятой) из выбранной координаты (рис. 109).
    * **Клонировать** – чтобы создать координату, идентичную выбранной.

   .. raw:: html

      <center>

   |image19|

   .. raw:: html

      </center>

   .. raw:: html

      <center>

   Рисунок 108 – Добавление координаты

   .. raw:: html

      </center>

2. Нажмите левой клавишей мыши на кнопку |image20|, которая расположена
   слева от требуемой координаты. Ниже добавится новая координата, в
   полях **Широта** и **Долгота** которой будут указаны градусы (целые
   числа до запятой) из выбранной координаты (рис. 109).

   .. raw:: html

      <center>

   |image21|

   .. raw:: html

      </center>

.. raw:: html

   <center>

Рисунок 109 – Строка новой координаты

.. raw:: html

   </center>

Если какие-либо координаты точки следует поменять местами, используйте
команды контекстного меню **Поднять наверх** и **Опустить вниз**.

Если требуется удалить какую-либо координату фигуры, выполните для этой
координаты команду контекстного меню **Удалить**.

Экспорт/импорт геоданных объекта
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Если требуется сохранить геоданные, которые содержатся в универсальной
геокатегории (например, чтобы перенести их в универсальную геокатегорию
другого объекта), нажмите на кнопку **Скопировать отрисованный GeoJSON
слоя в буфер обмена** |image22| (рис. 110).

Чтобы импортировать скопированные геоданные в универсальную геокатегорию
другого объекта, перейдите в его карточку. Вставьте геоданные,
сохраненные в буфере обмена, в строку **Поле для импортирования своего
GeoJSON**. Затем нажмите на кнопку **Отрисовать скопированный GeoJSON**
|image23|.

.. raw:: html

   <center>

|image24|

.. raw:: html

   </center>

   <center>

Рисунок 110 – Инструменты для экспорта/импорта геоданных объекта

.. raw:: html

   </center>

Работа с картографическими слоями
---------------------------------

Подсистема геоданных предоставляет возможность работы со следующими
типами слоев:

-  Постоянные векторные слои,
-  Временные векторные слои,
-  Растровые слои.

Для настройки и хранения слоев в дереве объектов предназначена системная
папка **Картографические слои**. Данная папка содержит вложенную
системную папку **Геоподосновы**, которая предназначена для настройки и
хранения геоподоснов_. Содержимое папки **Геоподосновы** отображается в
`Меню управления геоподосновами`_ на карте.

.. _геоподоснов: Подключение удаленного растрового слоя

Для систематизации других слоев внутри системной папки
**Картографические слои** рекомендуется создать следующие группы слоев:

-  **Основное меню** – для настройки и хранения постоянных векторных и
   растровых слоев.
-  **Временные общие слои** – для настройки и хранения временных
   векторных слоев (Слоев CQL).
-  **Личные слои** – для слоев различных типов, сохраненных в профиле
   текущего пользователя.

Внутри данных групп слоев можно создавать группы слоев любого уровня
вложенности. Группы предназначены для систематизации и одновременной
настройки групп/слоев, которые входят в их состав.

Настройка порядка расположения групп/слоев внутри системной папки
**Картографические слои** и перемещение слоев из группы в группу (при
необходимости) осуществляется в соответствии с общими принципами
управления объектами системы.

Иерархия групп/слоев, которые содержатся в системной папке
**Картографические слои** (за исключением папки **Геоподосновы**),
воспроизводится в меню управления слоями на карте. Если пользователь
меняет порядок расположения групп и/или вложенных в них слоев в папке
**Картографические слои**, то после перезагрузки карты соответствующим
образом меняется порядок расположения групп/слоев в меню управления
слоями.

Порядок действий при создании группы/слоя
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Чтобы создать в системе группу слоев, выполните следующие действия:

1. Создайте пустой картографический слой типа **Группа**.
2. Наполните данную группу вложенными группами и/или картографическими
   слоями.
3. Если требуется выполнить одновременную настройку вложенных
   групп/слоев, выполните настройку свойств данной группы.
4. Выполните настройку прав доступа пользователей к данной группе.

Чтобы создать в системе слой какого-либо типа, выполните следующие
действия:

1. Создайте пустой картографический слой.
2. Если из картографического слоя следует создать постоянный векторный
   слой, выполните загрузку геокодированных данных в формате JSON и/или
   переместите в данный слой объекты, содержащие универсальную
   геокатегорию, и/или создайте связь слоя с данными объектами.
3. Если из картографического слоя следует создать временный векторный
   слой, настройте в данном слое поисковый запрос и/или переместите в
   данный слой объекты, содержащие универсальную геокатегорию, и/или
   создайте связь слоя с данными объектами.
4. Если из картографического слоя следует создать растровый слой,
   выполните подключение удаленного растрового слоя.
5. При необходимости выполните настройку картографического слоя.
6. Выполните настройку прав доступа пользователей к данному
   картографическому слою.

Создание группы слоев/картографического слоя
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Чтобы создать группу слоев или картографический слой, в дереве объектов
выделите правой клавишей мыши:

-  Системную папку **Картографические слои**, чтобы создать группу/слой
   на верхнем уровне иерархии.
-  Системную папку **Картографические слои > Геоподосновы**, чтобы
   создать геоподоснову.
-  Требуемую группу слоев, чтобы создать вложенную группу/слой.

Затем выполните команду контекстного меню **Создать > Выбрать из
списка** (рис. 111).

.. raw:: html

   <center>

|image25|

.. raw:: html

   </center>

   <center>

Рисунок 111 – Создание картографического слоя

.. raw:: html

   </center>

В окне **Выбор типа создаваемого объекта** (рис. 112) найдите в списке
тип объектов **Картографический слой**. Данный тип содержится в системе
по умолчанию.

Чтобы выполнить быстрый поиск этого типа, в строке ввода укажите
начальные буквы его названия (например, «карт») и нажмите на клавишу
**Enter** на клавиатуре. В списке отобразятся типы объектов,
соответствующие условиям поиска. Выберите тип **Картографический слой**
двойным щелчком мыши.

.. raw:: html

   <center>

|image26|

.. raw:: html

   </center>

   <center>

Рисунок 112 – Окно **Выбор типа создаваемого объекта**

.. raw:: html

   </center>

Откроется карточка нового объекта типа **Картографический слой** (рис.
113). Заполните в карточке следующие поля:

-  **Название** – укажите название, под которым данная группа/слой будет
   отображаться в дереве объектов. Название может содержать цифры,
   латинские и русские буквы, пробелы.
-  **Системное имя** – может содержать только латинские буквы и цифры
   без пробелов.
-  **Имя в меню** – название, под которым группа/слой будет отображаться
   в меню управления слоями.
-  **Тип слоя**:

   -  Если требуется создать группу слоев, выберите значение **Группа**.
   -  Если требуется создать геоподоснову, выберите значение
      **Подложка**.
   -  Если требуется создать картографический слой, выберите значение
      **Слой**.

На панели инструментов карточки нажмите на кнопку **Сохранить**
|image27|.

.. raw:: html

   <center>

|image28|

.. raw:: html

   </center>

   <center>

Рисунок 113 – Карточка нового объекта типа **Картографический слой**

.. raw:: html

   </center>

Дерево объектов автоматически обновится, и созданная группа/слой
отобразится в выбранной папке.

Создание постоянного векторного слоя
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Создание постоянного векторного слоя может быть выполнено размещением в
контейнере объектов/связей объектов из других сегментов системы, а также
путем загрузки в пустой картографический слой геокодированных данных в
формате JSON. Для объектов, описание которых содержится в файле JSON,
необходимо предварительно создать соответствующий тип объектов.
Например, если в файле содержится описание заправочных станций, в
системе необходимо создать тип объекта **Заправочные станции**.

Чтобы выполнить загрузку геокодированных данных в картографический слой,
в главном меню системы нажмите на кнопку **Карта** (рис. 114).

.. raw:: html

   <center>

|image29|

.. raw:: html

   </center>

   <center>

Рисунок 114 – Кнопка **Карта**

.. raw:: html

   </center>

Перетащите мышью на карту файл JSON из папки проводника Windows, в
которой он расположен. В диалоговом окне, представленном на рисунке 115,
нажмите на кнопку **ОК**.

.. raw:: html

   <center>

|image30|

.. raw:: html

   </center>

   <center>

Рисунок 115 – Подтверждение действия

.. raw:: html

   </center>

В окне **Выбор контейнера слоя** (рис. 116) выберите для загрузки
объекта картографический слой. Нажмите на кнопку **Далее**.

.. raw:: html

   <center>

|image31|

.. raw:: html

   </center>

   <center>

Рисунок 116 – Окно **Выбор контейнера слоя**

.. raw:: html

   </center>

В окне **Выбор типа** (рис. 117) укажите, о каком типе объектов
содержится информация в файле JSON.

.. raw:: html

   <center>

|image32|

.. raw:: html

   </center>

   <center>

Рисунок 117 – Окно **Выбор типа**

.. raw:: html

   </center>

Откроется окно **Сопоставление полей** (рис. 118). В левой части данного
окна (1) отображается дерево свойств импортируемого файла, в правой
части (2) – дерево свойств выбранного типа объектов. Свойства файла и
свойства типа следует сопоставить друг другу с помощью таблицы,
расположенной в центральной части окна (3).

.. raw:: html

   <center>

|image33|

.. raw:: html

   </center>

   <center>

Рисунок 118 – Окно **Сопоставление полей**

.. raw:: html

   </center>

Чтобы начать сопоставление, нажмите на кнопку |image34|, которая
расположена над таблицей.

В таблицу добавится пустая строка. Щелкните по ней мышью, чтобы
активировать свойства файла (1) и типа (2).

При сопоставлении свойств выполните следующие шаги:

1. Поместите в системное имя типа любое свойство файла (рис. 119). Для
   этого разверните системные свойства типа: **System > Основные
   свойства**. Двойным щелчком мыши выделите свойство **name**. Оно
   переместится в столбец таблицы **Куда**. Разверните свойства файла и
   двойным щелчком мыши выделите любое из его свойств. Оно переместится
   в столбец таблицы **Что**.

   .. raw:: html

      <center>

   |image35|

   .. raw:: html

      </center>

   .. raw:: html

      <center>

   Рисунок 119 – Системное имя типа

   .. raw:: html

      </center>

2. Укажите, в какое свойство типа следует поместить геоданные из файла
   (рис. 120). Для этого добавьте в таблицу новую строку нажатием на
   кнопку |image36|, которая расположена над таблицей, и щелкните по
   данной строке мышью, чтобы активировать свойства файла и типа. Затем
   в свойствах типа выберите свойство **object > geo > geoJSON**, а в
   свойствах файла – свойство **geometry**.

   .. raw:: html

      <center>

   |image37|

   .. raw:: html

      </center>

   .. raw:: html

      <center>

   Рисунок 120 – Геоданные

   .. raw:: html

      </center>

3. Укажите, в какие поля типа следует поместить основные свойства файла
   (properties). Пример сопоставления представлен на рисунке 121.

.. raw:: html

   <center>

|image38|

.. raw:: html

   </center>

.. raw:: html

   <center>

Рисунок 121 – Основные свойства

.. raw:: html

   </center>

Чтобы выполнить загрузку данных в соответствии с указанными
требованиями, нажмите на кнопку **Запустить**. Данная кнопка расположена
в верхней части окна **Сопоставление полей**.

Импорт данных будет выполнен в фоновом режиме. После завершения импорта
обновите содержимое папки **Картографические слои**. В составе
картографического слоя, в который осуществлялась загрузка данных,
отобразятся геокодированные объекты, соответствующие объектам, описанным
в файле.

Создание временного векторного слоя
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
 Описание будет добавлено позже.

Подключение удаленного растрового слоя
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Растровые слои можно подключать как из источников, находящихся на
внешних серверах, так и из внутреннего репозитория, находящегося на
GIS-сервере CITORUS. Подключение удаленного растрового слоя может
выполняться в системе для решения следующих задач:

-  Для создания *геоподосновы* – картографической поверхности, которая
   является фоном для слоев на карте. В качестве геоподоснов могут
   выступать, например, подключенные удаленно картографические сервисы
   Google Maps, Яндекс.Карты и другие.
-  Для создания слоя, который позволяет получать необходимые данные из
   внутреннего репозитория или с какого-либо удаленного сервиса в
   онлайн-режиме.

Чтобы подключить растровый слой, откройте карточку ранее созданного
картографического слоя в режиме редактирования и заполните следующие
поля:

-  **Источник** – выберите тип сервиса, с которого осуществляется
   подключение удаленного растрового слоя.
-  **Внешний url** – вставьте ссылку на данный сервис. Например,
   **http://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}**.
-  | **Доп. опции** – укажите дополнительные параметры запроса к
   удаленному слою. Например, для WMS-сервисов строка может выглядеть
   следующим образом:
   | 
   **{"constructorOptions":{"layers":"name","format":"image/png","bbox":"26,9,180,83.5","transparent":true}}**,
   где:

   -  **layers** – название слоя,
   -  **format** – формат данных слоя,
   -  **bbox** – границы слоя,
   -  **transparent** – прозрачность слоя (true/false).

.. raw:: html

   <center>

|image39|

.. raw:: html

   </center>

   <center>

Рисунок 122 – Настройки растрового слоя

.. raw:: html

   </center>

Сохраните данный слой. Для этого на панели инструментов карточки нажмите
на кнопку |image40|.

При необходимости выполните дополнительную настройку слоя.

Настройка группы/слоя
~~~~~~~~~~~~~~~~~~~~~

Группы слоев и картографические слои имеют идентичные настройки. Если
настройка свойств осуществляется в карточке группы слоев, то данные
настройки применяются ко всем группам/слоям, вложенным в данную группу.
Если настройка свойств выполняется в карточке картографического слоя, то
настройки применяются только к данному слою. Настройки слоя имеют
больший приоритет, чем настройки группы слоев, в которую он входит.

Чтобы выполнить настройку какой-либо группы слоев или картографического
слоя, выполните один из следующих шагов:

-  В дереве объектов выделите требуемую группу/слой нажатием правой
   клавиши мыши и выполните команду контекстного меню **Редактировать**
   (рис. 123). В новой вкладке откроется карточка группы/слоя (рис.
   124).

.. raw:: html

   <center>

|image41|

.. raw:: html

   </center>

   <center>

Рисунок 123 – Контекстное меню

.. raw:: html

   </center>

-  В дереве объектов выделите требуемую группу/слой нажатием левой
   клавиши мыши. В новой вкладке откроется карточка группы/слоя (рис.
   124). Чтобы активировать ее поля, на панели инструментов нажмите на
   кнопку **Редактировать** |image42|.

.. raw:: html

   <center>

|image43|

.. raw:: html

   </center>

   <center>

Рисунок 124 – Карточка картографического слоя

.. raw:: html

   </center>

Для редактирования доступно любое поле карточки группы/слоя.

Общие настройки
"""""""""""""""

Следующие поля предназначены как для настройки групп слоев, так и для
настройки слоев различных типов (рис. 125):

-  **Название** – имя, под которым данная группа/слой отображается в
   дереве объектов. Название может содержать цифры, латинские и русские
   буквы, пробелы.
-  **Описание (всплывающая подсказка)** – поле для текстового описания
   группы/слоя.
-  **Ссылки** – поле для ввода ссылки (указателя) на другой объект.
-  **Системное имя** – обязательное поле. Без системного имени
   группа/слой существовать не может. Системное имя может содержать
   только латинские буквы и цифры без пробелов.
-  **Имя в меню** – название, под которым данная группа/слой
   отображается в меню управления слоями.
-  **Тип слоя** – выпадающий список для выбора типа объекта:

   -  **Группа** – группа слоев. Группы слоев содержатся в папке
      **Картографические слои** дерева объектов и в меню управления
      слоями.
   -  **Слой** – картографический слой. Слои содержатся в папке
      **Картографические слои** дерева объектов и в меню управления
      слоями.
   -  **Подложка** – геоподоснова. Геоподосновы содержатся в папке
      **Картографические слои > Геоподосновы** дерева объектов и в меню
      управления геоподосновами.

-  **Включить по умолчанию** – если флажок установлен, то слой
   отображается на карте постоянно. Даже если пользователь отключает
   данный слой в меню управления слоями, после перезагрузки карты слой
   автоматически включается и отображается снова.
-  **Минимальное и максимальное приближение** – определение минимального
   и максимального масштаба, на котором отображается слой.
-  **Всплывающая подсказка** – текст для всплывающей подсказки, которая
   отображается при наведении курсора мыши на название слоя в меню
   управления слоями. По умолчанию всплывающая подсказка содержит только
   название, указанное в поле **Имя в меню**.

.. raw:: html

   <center>

|image44|

.. raw:: html

   </center>

   <center>

Рисунок 125 – Общие поля

.. raw:: html

   </center>

Настройки векторных слоев
"""""""""""""""""""""""""

Настройки кластеризации
#######################

При необходимости для объектов векторных слоев можно **Использовать
кластеризацию** (рис. 126).

*Кластеризация* – это объединение объектов слоя, расположенных близко
друг к другу, при увеличении масштаба карты. При объединении объекты
отображаются в виде одной точки (кластера). На кластере представлено
число объектов, которые он объединяет. При уменьшении масштаба карты
происходит обратный процесс: кластер распадается на отдельные объекты.

По умолчанию кластер отображается на карте в виде белой точки. Внешний
вид кластера можно настроить с помощью следующих полей:

-  **Фон кластера** – цвет заливки кластера;
-  **Цвет обводки** – цвет рамки кластера;
-  **Цвет шрифта** – цвет шрифта цифры, которая отображается в центре
   кластера и обозначает число объединенных объектов.

.. raw:: html

   <center>

|image45|

.. raw:: html

   </center>

   <center>

Рисунок 126 – Настройки векторных слоев

.. raw:: html

   </center>

Настройка отображения маркеров слоя
###################################

Чтобы упростить визуальное восприятие объектов слоя на карте, можно
назначить для них подходящую по смыслу иконку. Например, для больниц
можно загрузить иконку с изображением красного креста. Для этого в поле
**Маркер** (рис. 126) следует нажать на кнопку **Прикрепить файл** и в
проводнике Windows выбрать файл иконки. После сохранения карточки слоя
его объекты будут обозначены на карте с помощью выбранной иконки.

Свойства всплывающего окна
##########################

Группа полей **Свойства всплывающего окна** (рис. 126) предназначена для
создания и наполнения данными всплывающих окон. Всплывающие окна
отображаются при наведении курсора мыши на объекты слоя на карте и могут
содержать одно или несколько свойств объекта.

Чтобы создать всплывающее окно, следует добавить в него хотя бы одно
свойство. Для этого:

-  В группе полей **Свойства всплывающего окна**, в поле слева укажите
   название свойства объекта, которое следует отображать во всплывающем
   окне. Например, **Порядковый номер**.
-  В поле справа введите строку вида **<object.link.field>**, где:

   -  **link** – ссылка на категорию, которая содержит поле для описания
      требуемого свойства. Например, чтобы во всплывающем окне
      отображался порядковый номер объекта, откройте категорию, которая
      была использована при создании типа данного объекта, и которая
      содержит поле **Порядковый номер**, и скопируйте ссылку (link) на
      данную категорию.
   -  **field** – название требуемого поля в категории. Например,
      **IndexNumber**.

Чтобы добавить во всплывающее окно еще одно свойство объекта, нажмите на
кнопку |image46|, которая расположена слева от группы полей **Свойства
всплывающего окна**.

Растеризация векторного слоя
############################

Чтобы преобразовать векторный слой в растровый слой, следует установить
флажок **Включить растеризацию** (рис. 126). Для настройки свойств
преобразованного слоя предназначено поле **Настр. растер.** (см.
Настройки растровых слоев).

Кэширование данных
##################

Чтобы данные векторных слоев сохранялись в кэше, поставьте флажок
**Кэширование данных** (рис. 126).

Экспорт геоданных слоя
######################

Чтобы сохранить геокодированные данные слоя в файл в формате JSON, в
поле **Экспортировать** нажмите на кнопку **GeoJSON** (рис. 126). Файл
сохранится в папку, выбранную в браузере для загрузки данных по
умолчанию.

Настройки растровых слоев
"""""""""""""""""""""""""

Для настройки растровых слоев в карточке предназначены следующие поля
(рис. 127):

-  **Источник** – тип сервиса, с которого осуществляется подключение
   удаленного растрового слоя:

   -  **Запрос**,
   -  **Сервис тайлов**,
   -  **Сервис тайлов WMS** – подключение к слою осуществляется по
      протоколу WMS,
   -  **Сервис тайлов ArcGIS** – подключаемый слой создан с помощью ПО
      ArcGIS,
   -  **Сервис GeoJSON**,
   -  **Сервис Геомиксер**.

-  **Внешний url** – ссылка на сервис, на котором размещен подключаемый
   растровый слой.
-  **Кэширование тайлов** – сохранять в кэше данные растровых слоев.

.. raw:: html

   <center>

|image47|

.. raw:: html

   </center>

   <center>

Рисунок 127 – Настройки растровых слоев

.. raw:: html

   </center>

-  **Доп. опции** – дополнительные параметры запроса к удаленному слою. Например, для WMS-сервисов в поле можно вставить строку следующего вида: **{"constructorOptions":{"layers":"name","format":"image/png","bbox":"26,9,180,83.5","transparent":true}}**,
   где:

   -  **layers** – название слоя,
   -  **format** – формат данных слоя,
   -  **bbox** – границы слоя,
   -  **transparent** – прозрачность слоя (true/false).

-  **Настр. растер.** – данное поле аналогично полю **Доп. опции**, но используется для настройки растровых слоев, которые были преобразованы из векторных (см. раздел Растеризация векторного слоя).

Работа с картой
---------------

Чтобы открыть карту, в главном меню системы нажмите на кнопку **Карта**
(рис. 128).

.. raw:: html

   <center>

|image48|

.. raw:: html

   </center>

   <center>

Рисунок 128 – Кнопка **Карта**

.. raw:: html

   </center>

Карта откроется в новой вкладке (рис. 129).

Изменение масштаба карты выполняется стандартными способами, которые
используются при работе с географическими информационными системами.
Например:

1. Прокруткой колесика мыши: прокручивание от себя увеличивает масштаб,
   на себя – уменьшает.
2. С помощью масштабной линейки, которая расположена в левой части
   карты: нажатие на кнопку |image49| или перемещение бегунка вверх
   увеличивает масштаб, нажатие кнопки |image50| и перемещение бегунка
   вниз уменьшает масштаб.

Текущий масштаб карты отображается в левом нижнем углу.

Для перемещения по карте можно использовать клавиши клавиатуры, на
которых изображены стрелки, указывающие вверх, вниз, влево и вправо.
Кроме того, перемещаться по карте можно, удерживая левую клавишу мыши.

Для работы с картой предназначены следующие меню:

1. Меню управления геоподосновами.
2. Меню управления слоями.
3. Меню инструментов.

.. raw:: html

   <center>

|image51|

.. raw:: html

   </center>

   <center>

Рисунок 129 – Инструменты работы с картой

.. raw:: html

   </center>

Меню управления геоподосновами
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Меню управления геоподосновами разворачивается нажатием на кнопку,
представленную на рисунке 129 под цифрой 1. В меню отображается список
геоподоснов, созданных пользователем (рис. 130).

Геоподосновы – это картографические поверхности, которые служат фоном
для слоев. Для выбора какой-либо геоподосновы щелкните по ней мышью.

.. raw:: html

   <center>

|image52|

.. raw:: html

   </center>

   <center>

Рисунок 130 – Меню управления геоподосновами

.. raw:: html

   </center>

Меню управления слоями
~~~~~~~~~~~~~~~~~~~~~~

Меню управления слоями разворачивается при нажатии на кнопку,
представленную на рисунке 131.

.. raw:: html

   <center>

|image53|

.. raw:: html

   </center>

   <center>

Рисунок 131 – Кнопка перехода в меню управления слоями

.. raw:: html

   </center>

Данное меню содержит следующие инструменты (рис. 132):

-  **Поиск по координатам** – группа полей позволяет выполнить быстрый
   переход в требуемую точку на карте. Географические координаты точки
   можно указать в градусах в виде десятичной дроби (разделитель –
   запятая) или в градусах, минутах и секундах.
-  **Поиск по территориальному объекту** – поле или группа полей
   позволяет выполнить быстрый переход к требуемому территориальному
   объекту.
-  **Сохранить карту** – при нажатии на данную кнопку система запоминает
   текущую конфигурацию карты: фокус карты, включенный слой и выбранную
   геоподоснову – и воспроизводит ее при повторном открытии карты.

.. raw:: html

   <center>

|image54|

.. raw:: html

   </center>

.. raw:: html

   <center>

Рисунок 132 – Меню управления слоями

.. raw:: html

   </center>

-  |image55| – координаты точки, на которую указывает курсор на карте
   (рис. 133).
-  **Текущий масштаб** – текущий масштаб слоя.
-  **Доступные слои** – в списке отображаются слои, которые содержатся в
   дереве объектов, в папке **Картографические слои** (за исключением
   папки **Геоподосновы**) и доступны текущему пользователю (см. раздел
   Настройка прав доступа). Чтобы включить/отключить какой-либо слой или
   группу слоев на карте, следует поставить/снять флажок,
   соответствующий данному слою или группе слоев.

.. raw:: html

   <center> 

|image56|

.. raw:: html

   </center>

.. raw:: html

   <center>

Рисунок 133 – Меню управления слоями

.. raw:: html

   </center>

Если в меню управления слоями для отображения выбран векторный слой,
атрибутивная информация которого содержит дату, или растровый слой, у
точек которого есть признак даты, то в левом нижнем углу карты
появляется таймлайн (рис. 134). Данный инструмент предназначен для
фильтрации объектов/точек слоя по дате. Например, если объекты/точки
слоя обозначают на карте пожары, которые произошли в первом полугодии
2017 года, то с помощью таймлайна можно настроить отображение пожаров,
которые произошли в определенный день или за какой-либо временной
промежуток в данном полугодии.

Интервал дат, которые содержат объекты/точки слоя, отображается под
таймлайном.

.. raw:: html

   <center>

|image57|

.. raw:: html

   </center>

   <center>

Рисунок 134 – Таймлайн

.. raw:: html

   </center>

Чтобы на карте отобразились объекты/точки за какой-либо временной
период, воспользуйтесь одним из следующих способов:

1. Обозначьте требуемый временной период на таймлайне с помощью левого и
   правого бегунка.
2. Откройте календарь нажатием на кнопку |image58| (рис. 135). Щелчком
   мыши выберите начальную дату требуемого периода. Затем, удерживая на
   клавиатуре клавишу **Shift**, щелчком мыши отметьте конечную дату
   требуемого периода.

Чтобы на карте отобразились объекты/точки за определенную дату, нажмите
на кнопку |image59| и укажите требуемую дату с помощью календаря.

.. raw:: html

   <center>

|image60|

.. raw:: html

   </center>

   <center>

Рисунок 135 – Календарь

.. raw:: html

   </center>

Меню инструментов
~~~~~~~~~~~~~~~~~

Меню инструментов разворачивается при нажатии на кнопку |image61| (рис.
136).

Включение того или иного инструмента из меню осуществляется нажатием на
соответствующую ему кнопку, выключение инструмента – повторным нажатием
на соответствующую кнопку.

С помощью кнопок меню инструментов можно выполнить следующие действия:

-  |image62| – отобразить на карте координатную сетку.

.. raw:: html

   <center>

|image63|

.. raw:: html

   </center>

   <center>

Рисунок 136 – Меню инструментов

.. raw:: html

   </center>

-  |image64| – измерить расстояние от одной точки до другой линейкой.

.. raw:: html

   <center>

|image65|

.. raw:: html

   </center>

   <center>

Рисунок 137 – Линейка

.. raw:: html

   </center>

-  Нарисовать объект: полигон |image66| или линию |image67| – и создать
   карточку данного объекта.

Чтобы нарисовать полигон, нажмите на кнопку |image68|. Щелчками мыши по
карте установите три крайние точки полигона. Затем нажмите на точку
полигона, которая была установлена первой. В центре полигона отобразится
маркер со всплывающим окном, в котором содержится ссылка для перехода в
карточку нарисованного объекта (рис. 138).

.. raw:: html

   <center>

|image69|

.. raw:: html

   </center>

   <center>

Рисунок 138 – Полигон

.. raw:: html

   </center>

Если фигура объекта соответствует требованиям, перейдите в его карточку.

Если нарисованную фигуру полигона требуется редактировать, нажмите на
кнопку |image70|. На фигуре отобразятся крайние и промежуточные точки,
которые можно перемещать с помощью мыши (рис. 139). Установите точки в
требуемое положение и нажмите на кнопку **Сохранить**, которая
отображается под кнопкой |image71|. Затем перейдите в карточку полигона,
как это описано выше.

.. raw:: html

   <center>

|image72|

.. raw:: html

   </center>

   <center>

Рисунок 139 – Режим редактирования полигона

.. raw:: html

   </center>

Чтобы нарисовать линию, нажмите на кнопку |image73|. Щелчками мыши по
карте установите крайние точки линии. Затем нажмите повторно на конечную
точку фигуры. Над крайней точкой отобразится маркер со всплывающим
окном, в котором содержится ссылка для перехода в карточку нарисованного
объекта (рис. 140).

.. raw:: html

   <center>

|image74|

.. raw:: html

   </center>

   <center>

Рисунок 140 – Линия

.. raw:: html

   </center>

Если фигура объекта соответствует требованиям, перейдите в карточку
объекта.

Если фигуру объекта требуется редактировать, нажмите на кнопку
|image75|. На линии отобразятся крайние и промежуточные точки, которые
можно перемещать с помощью мыши (рис. 141). Установите точки в требуемое
положение и нажмите на кнопку **Сохранить**, которая отображается под
кнопкой |image76|. Затем перейдите в карточку нарисованного объекта, как
это описано выше.

.. raw:: html

   <center>

|image77|

.. raw:: html

   </center>

   <center>

Рисунок 141 – Режим редактирования линии

.. raw:: html

   </center>

На карте также можно отметить объект в виде точки (маркера). Установка
маркера осуществляется щелчком мыши по требуемому участку карты. Переход
в карточку отмеченного объекта осуществляется из всплывающей подсказки.

Печать карты
~~~~~~~~~~~~

Чтобы распечатать текущий фрагмент карты, нажмите на кнопку |image78|,
которая расположена под меню инструментов (рис. 142).

В текущей вкладке браузера будет сформирована страница печати (пример
представлен на рисунке 40):

-  В заголовке страницы печати отображается текущая дата и время.
-  В центральной части страницы – текущий фрагмент карты.
-  В нижней части страницы – кнопка для печати и кнопка для выхода из
   режима печати карты.

.. raw:: html

   <center>

|image79|

.. raw:: html

   </center>

   <center>

Рисунок 142 – Страница печати

.. raw:: html

   </center>

.. |image0| image:: https://github.com/citoruspm/GeoData/blob/master/ris1.png?raw=true
.. |image1| image:: https://github.com/citoruspm/GeoData/blob/master/2.png?raw=true
.. |image2| image:: https://github.com/citoruspm/GeoData/blob/master/3.png?raw=true
.. |image3| image:: https://github.com/citoruspm/GeoData/lob/master/1.png?raw=true
.. |image4| image:: https://github.com/citoruspm/GeoData/blob/master/4.png?raw=true
.. |image5| image:: https://github.com/citoruspm/GeoData/blob/master/5.png?raw=true
.. |image6| image:: https://github.com/citoruspm/GeoData/blob/master/ris2.png?raw=true
.. |image7| image:: https://github.com/citoruspm/GeoData/blob/master/4.png?raw=true
.. |image8| image:: https://github.com/citoruspm/GeoData/blob/master/6.png?raw=true
.. |image9| image:: https://github.com/citoruspm/GeoData/blob/master/6.png?raw=true
.. |image10| image:: https://github.com/citoruspm/GeoData/blob/master/ris3.png?raw=true
.. |image11| image:: https://github.com/citoruspm/GeoData/blob/master/7.png?raw=true
.. |image12| image:: https://github.com/citoruspm/GeoData/blob/master/ris4.png?raw=true
.. |image13| image:: https://github.com/citoruspm/GeoData/blob/master/7.png?raw=true
.. |image14| image:: https://github.com/citoruspm/GeoData/blob/master/6.png?raw=true
.. |image15| image:: https://github.com/citoruspm/GeoData/blob/master/6.png?raw=true
.. |image16| image:: https://github.com/citoruspm/GeoData/blob/master/ris5.png?raw=true
.. |image17| image:: https://github.com/citoruspm/GeoData//blob/master/8.png?raw=true
.. |image18| image:: https://github.com/citoruspm/GeoData/blob/master/8.png?raw=true
.. |image19| image:: https://github.com/citoruspm/GeoData/blob/master/ris6.png?raw=true
.. |image20| image:: https://github.com/citoruspm/GeoData/blob/master/8.png?raw=true
.. |image21| image:: https://github.com/citoruspm/GeoData/blob/master/ris7.png?raw=true
.. |image22| image:: https://github.com/citoruspm/GeoData/blob/master/9.png?raw=true
.. |image23| image:: https://github.com/citoruspm/GeoData/blob/master/10.png?raw=true
.. |image24| image:: https://github.com/citoruspm/GeoData/blob/master/ris8.png?raw=true
.. |image25| image:: https://raw.githubusercontent.com/citoruspm/GeoData/master/ris9.png
.. |image26| image:: https://github.com/citoruspm/GeoData/blob/master/ris10.png?raw=true
.. |image27| image:: https://github.com/citoruspm/GeoData/blob/master/11.png?raw=true
.. |image28| image:: https://github.com/citoruspm/GeoData/blob/master/ris11.png?raw=true
.. |image29| image:: https://github.com/citoruspm/GeoData/blob/master/ris12.png?raw=true
.. |image30| image:: https://github.com/citoruspm/GeoData/blob/master/ris13.png?raw=true
.. |image31| image:: https://github.com/citoruspm/GeoData/blob/master/ris14.png?raw=true
.. |image32| image:: https://github.com/citoruspm/GeoData/blob/master/ris15.png?raw=true
.. |image33| image:: https://github.com/citoruspm/GeoData/blob/master/ris16.png?raw=true
.. |image34| image:: https://github.com/citoruspm/GeoData/blob/master/12.png?raw=true
.. |image35| image:: https://github.com/citoruspm/GeoData/blob/master/ris16_1.png?raw=true
.. |image36| image:: https://github.com/citoruspm/GeoData/blob/master/12.png?raw=true
.. |image37| image:: https://github.com/citoruspm/GeoData/blob/master/ris16_2.png?raw=true
.. |image38| image:: https://github.com/citoruspm/GeoData/blob/master/ris16_3.png?raw=true
.. |image39| image:: https://github.com/citoruspm/GeoData/blob/master/ris17.png?raw=true
.. |image40| image:: https://github.com/citoruspm/GeoData/blob/master/11.png?raw=true
.. |image41| image:: https://github.com/citoruspm/GeoData/blob/master/ris18.png?raw=true
.. |image42| image:: https://github.com/citoruspm/GeoData/blob/master/13.png?raw=true
.. |image43| image:: https://github.com/citoruspm/GeoData/blob/master/ris19.png?raw=true
.. |image44| image:: https://github.com/citoruspm/GeoData/blob/master/ris20.png?raw=true
.. |image45| image:: https://github.com/citoruspm/GeoData/blob/master/ris21.png?raw=true
.. |image46| image:: https://github.com/citoruspm/GeoData/blob/master/8.png?raw=true
.. |image47| image:: https://github.com/citoruspm/GeoData/blob/master/ris22.png?raw=true
.. |image48| image:: https://github.com/citoruspm/GeoData/blob/master/ris23.png?raw=true
.. |image49| image:: https://github.com/citoruspm/GeoData/blob/master/2.png?raw=true
.. |image50| image:: https://github.com/citoruspm/GeoData/blob/master/3.png?raw=true
.. |image51| image:: https://github.com/citoruspm/GeoData/blob/master/ris24.png?raw=true
.. |image52| image:: https://github.com/citoruspm/GeoData/blob/master/ris25.png?raw=true
.. |image53| image:: https://github.com/citoruspm/GeoData/blob/master/ris26.png?raw=true
.. |image54| image:: https://github.com/citoruspm/GeoData/blob/master/ris27.png?raw=true
.. |image55| image:: https://github.com/citoruspm/GeoData/blob/master/14.png?raw=true
.. |image56| image:: https://github.com/citoruspm/GeoData/blob/master/ris28.png?raw=true
.. |image57| image:: https://github.com/citoruspm/GeoData/blob/master/ris29.png?raw=true
.. |image58| image:: https://github.com/citoruspm/GeoData/blob/master/15.png?raw=true
.. |image59| image:: https://github.com/citoruspm/GeoData/blob/master/15.png?raw=true
.. |image60| image:: https://github.com/citoruspm/GeoData/blob/master/ris30.png?raw=true
.. |image61| image:: https://github.com/citoruspm/GeoData/blob/master/4.png?raw=true
.. |image62| image:: https://github.com/citoruspm/GeoData/blob/master/5.png?raw=true
.. |image63| image:: https://github.com/citoruspm/GeoData/blob/master/ris31.png?raw=true
.. |image64| image:: https://github.com/citoruspm/GeoData/blob/master/16.png?raw=true
.. |image65| image:: https://github.com/citoruspm/GeoData/blob/master/ris32.png?raw=true
.. |image66| image:: https://github.com/citoruspm/GeoData/blob/master/17.png?raw=true
.. |image67| image:: https://github.com/citoruspm/GeoData/blob/master/18.png?raw=true
.. |image68| image:: https://github.com/citoruspm/GeoData/blob/master/17.png?raw=true
.. |image69| image:: https://github.com/citoruspm/GeoData/blob/master/ris33.png?raw=true
.. |image70| image:: https://github.com/citoruspm/GeoData/blob/master/6.png?raw=true
.. |image71| image:: https://github.com/citoruspm/GeoData/blob/master/6.png?raw=true
.. |image72| image:: https://github.com/citoruspm/GeoData/blob/master/ris34.png?raw=true
.. |image73| image:: https://github.com/citoruspm/GeoData/blob/master/18.png?raw=true
.. |image74| image:: https://github.com/citoruspm/GeoData/blob/master/ris35.png?raw=true
.. |image75| image:: https://github.com/citoruspm/GeoData/blob/master/6.png?raw=true
.. |image76| image:: https://github.com/citoruspm/GeoData/blob/master/6.png?raw=true
.. |image77| image:: https://github.com/citoruspm/GeoData/blob/master/ris36.png?raw=true
.. |image78| image:: https://github.com/citoruspm/GeoData/blob/master/19.png?raw=true
.. |image79| image:: https://github.com/citoruspm/GeoData/blob/master/ris37.png?raw=true
